<!DOCTYPE html>
<html lang="en" ng-app="myApp">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- Bootstrap -->
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Importation du css material design de Google-->
        <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.blue-light_blue.min.css" />
        <!-- Importation du css perso-->
        <link rel="stylesheet" type="text/css" href="static/css/style.css">
        <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
                <script src="static/js/konami.js"></script>
    </head>
    <body class="mdl-demo mdl-color--grey-100 mdl-color-text--grey-700 mdl-base" ng-controller="mainController">
        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            <header class="mdl-layout__header">
                <div class="mdl-layout__header-row">
                <!-- Title -->
                    <span class="mdl-layout-title">Alerte catastrophes</span>
                    <!-- Add spacer, to align navigation to the right -->
                    <div class="mdl-layout-spacer"></div>
                    <!-- Navigation. We hide it in small screens -->
                    <nav class="mdl-navigation mdl-layout--large-screen-only">
                        <a class="mdl-navigation__link" target="_blank" href="http://doc-apidsif.kermit.rd.francetelecom.fr/doku.php?id=bouchons:apimocks-howto">Help</a>
                    </nav>
                </div>
            </header>
            <div class="mdl-layout__drawer">
                <span class="mdl-layout-title">Alerte catastrophes</span>
                <nav class="mdl-navigation">
                    <a class="mdl-navigation__link" target="_blank" href="">Help</a>
                </nav>
            </div>
            <main class="mdl-layout__content">
                <!-- PAGE -->
                <div class="page-content">
                    <!--
                    =================================================================
                    =================================================================
                                PAGE ACCUEIL
                    =================================================================
                    =================================================================
                    -->
                    <div class="page-accueil">
                        <div class="mdl-grid">
                            <div class="mdl-cell mdl-cell--12-col">
                                <div class="mdl-card__supporting-text">
                                    <h1>
                                    <!--
                                        <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" id="refresh-btn" ng-click="refreshList()">
                                            <i class="material-icons">autorenew</i>
                                        </button>
                                    -->
                                        En cours
                                    </h1>
                                </div>
                            </div>
                        </div>
                        <div id="refresh-bar" ng-show="refreshStatus">
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--12-col mdl-typography--text-center">
                                    Loading
                                </div>
                            </div>
                            <!-- MDL Progress Bar with Indeterminate Progress -->
                            <div id="p2" style="width:100%" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
                        </div>

                        <div id="refresh-bar" ng-show="errorState">
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--12-col mdl-typography--text-center">
                                    <h2>
                                        Error !
                                    </h2>
                                    <p>
                                        {{debug}}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- list start -->
                        <div ng-init="refreshList()" id="api-list" class="event-list">
                            <div class="event-box">
                                <header>
                                  <h3 class="catastrophe-name">
                                    <!-- nom de la catastrophe -->
                                    {{catastrophe.name}}
                                  </h3>
                                  <p class="last-update">Dernière mise à jour : {{catastrophe.lastUpdate}}</p>
                                </header>
                                <div ng-show="isOpen">
                                    <div class="container" id="{{api.name}}-details">
                                      <h5 ng-show="api.nbGET > 0">
                                      <!-- Description de la catastrophe -->
                                          GET ({{catastrophe.nbGET}})
                                      </h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--
                    =================================================================
                    =================================================================
                                PAGE CATASTROPHE
                    =================================================================
                    =================================================================
                    -->

                    <div class="page-catastrophe">
                        <div class="mdl-grid">
                            <div class="mdl-cell mdl-cell--12-col">
                                <div class="mdl-card__supporting-text">
                                    <h1>
                                    <!--
                                        <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" id="refresh-btn" ng-click="refreshList()">
                                            <i class="material-icons">autorenew</i>
                                        </button>
                                    -->
                                        {{catastrophe.name}}
                                    </h1>
                                </div>
                            </div>
                        </div>
                        <div id="refresh-bar" ng-show="refreshStatus">
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--12-col mdl-typography--text-center">
                                    Loading
                                </div>
                            </div>
                            <!-- MDL Progress Bar with Indeterminate Progress -->
                            <div id="p2" style="width:100%" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
                        </div>

                        <div id="refresh-bar" ng-show="errorState">
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--12-col mdl-typography--text-center">
                                    <h2>
                                        Error !
                                    </h2>
                                    <p>
                                        {{debug}}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- list start -->
                        <div ng-init="refreshList()" id="api-list" class="event-page">
                            <div class="event-box">
                                <header>
                                  <h3 class="catastrophe-name">
                                    <!-- Status de la catastrophe -->
                                    {{catastrophe.status}}
                                  </h3>
                                  <p class="last-update">Dernière mise à jour : {{catastrophe.lastUpdate}}</p>
                                </header>
                                <div ng-show="isOpen">
                                    <div class="container" id="{{api.name}}-details">
                                    <!-- Liste de toutes les actualités -->
                                      <h5 ng-show="api.nbGET > 0">
                                        <!-- nom du statut -->
                                          GET ({{catastrophe.nbGET}})
                                      </h5>
                                      <p>Publié à {{catastrophe.statusDate}} par {{catastrophe.user}}</p>
                                        <!-- description du status -->
                                      <p>{{catastrophe.description}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- list end -->
                <!--
                <footer class="main-footer">
                    <div class="footer-content">
                        <p>Alerte catastrophes &copy; 2015 - Sité créé pour la nuit de l'info 2015</p>
                    </div>
                </footer>
                -->
            </main>
        </div>
<!-- script -->
        <script>

var app = angular.module('myApp', []);
app.controller('mainController', function($scope, $http)
{
    // vars declaration and initialisation
    $scope.catastrophes = [];   // cata list
    $scope.debug = "";  // error message / debug purpose

    // API list
    $scope.refreshList = function()
    {
        $scope.refreshStatus = true;
        $scope.errorState = false;
        $scope.apis = []

        $http({
                method: 'GET',
                url: '/test'
            }).then(function (response)
                    {
                        $scope.catastrophes = response.data;
                        //~ for (var cata in $scope.catastrophes)
                        //~ {
                            //~ $scope.catastrophes[cata].nb = apiNb;
                        //~ }
                        $scope.refreshStatus = false;
                        window.componentHandler.upgradeDom();
                    },
                    function (data, status, header, config)
                    {
                        $scope.refreshStatus = false;
                        $scope.errorState = true;
                        $scope.debug = "";

                        if(status)
                            $scope.debug += status + " : ";

                        if(data)
                            $scope.debug += data;
                    });

    }

    //~ // API's method list
    //~ $scope.getMethods = function(apiNb)
    //~ {
        //~ $http({
                //~ method: 'GET',
                //~ url: ('/admin/' + $scope.apis[apiNb].name)
            //~ }).then(function (response)
                    //~ {
                        //~ // hide all categories
                        //~ $scope.apis[apiNb].nbDELETE = 0;
                        //~ $scope.apis[apiNb].nbGET = 0;
                        //~ $scope.apis[apiNb].nbPOST = 0;
                        //~ $scope.apis[apiNb].nbPUT = 0;
                        //~ // retrieve methods
                        //~ $scope.apis[apiNb].methods = response.data.records;
                        //~ //
                        //~ $scope.apis[apiNb].data = $scope.apis[apiNb].methods;   // only for debug
                        //~ // count how many method in each category
                        //~ for (var method in $scope.apis[apiNb].methods)
                        //~ {
                            //~ if ($scope.apis[apiNb].methods[method].method == 'GET')
                                //~ $scope.apis[apiNb].nbGET = $scope.apis[apiNb].nbGET + 1;
                            //~ if ($scope.apis[apiNb].methods[method].method == 'POST')
                                //~ $scope.apis[apiNb].nbPOST = $scope.apis[apiNb].nbPOST + 1;
                            //~ if ($scope.apis[apiNb].methods[method].method == 'PUT')
                                //~ $scope.apis[apiNb].nbPUT = $scope.apis[apiNb].nbPUT + 1;
                            //~ if ($scope.apis[apiNb].methods[method].method == 'DELETE')
                                //~ $scope.apis[apiNb].nbDELETE = $scope.apis[apiNb].nbDELETE + 1;
                        //~ }
                    //~ },
                    //~ function (response) {});
    //~ }
});
        </script>
    </body>